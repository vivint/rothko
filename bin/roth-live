#!/usr/bin/env bash

set -e

if [ ! -z "$ROTH_USAGE" ]; then
	echo "runs a live server"
	exit 0
fi

SCRIPTDIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
cd "${SCRIPTDIR}/../ui"

LIVE="$(npm prefix)/node_modules/.bin/elm-live"

if [ ! -f "$LIVE" ]; then
	echo
	echo "elm-live not found. try running:"
	echo "	roth onboard"
	echo "and then this command again."
	echo
	exit 1
fi

echo "=== Warning ==="
echo "=== Rothko added a feature to run go templates in the html files"
echo "=== The elm-live functionality has not been ported to work with that"
echo "=== So while it will work somewhat, you'll see some artifacts"
echo "=== Warning ==="

"$LIVE" \
	--before-build="roth-gopher" \
	--dir=./site \
	--output=./site/js/Main.js \
	--pushstate \
	--host=0.0.0.0 \
	-- \
	src/Main.elm --debug