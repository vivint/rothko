#!/usr/bin/env bash

set -e

if [ ! -z "$ROTH_USAGE" ]; then
	echo "builds all the gopherjs packages"
	exit 0
fi

SCRIPTDIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
cd "${SCRIPTDIR}/../ui"

../scripts/check-vgo.sh || exit $?

log() {
	echo "---" "$@"
}

IMPORT=github.com/gopherjs/gopherjs
GOPHERJS=$(vgo list -f '{{ .Target }}' "${IMPORT}")
vgo install -v "${IMPORT}"

build() {
	IMPORT="$1"
	OUT="$2"

	log "building ${IMPORT} to ${OUT}..."
	"${GOPHERJS}" build -m -o "${OUT}" "${IMPORT}"
	rm "${OUT}.map"
}

build "github.com/vivint/rothko/draw/graph/js" "site/js/graph.js"
