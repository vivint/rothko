#!/usr/bin/env bash

set -e

if [ ! -z "$ROTH_USAGE" ]; then
	echo "runs a live server"
	exit 0
fi

SCRIPTDIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
cd "${SCRIPTDIR}/.."

LIVE="$(npm prefix)/node_modules/.bin/elm-live"

if [ ! -f "$LIVE" ]; then
	echo
	echo "(ERROR) elm-live not found. try running:"
	echo "(ERROR)     npm install --save-dev elm-live"
	echo "(ERROR) and then this command again."
	echo
	exit 1
fi

"$LIVE" \
	--before-build="roth-gopher" \
	--dir=./site \
	--output=site/js/Main.js \
	--pushstate \
	--host=0.0.0.0 \
	-- \
	src/Main.elm --debug
